\documentclass[runningheads,a4paper]{llncs}

\usepackage{amssymb}
\setcounter{tocdepth}{3}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{verbatim}
\usepackage[margin=1.25in]{geometry}
%\usepackage{amsfonts}
%\usepackage{amsthm}
\usepackage{subfigure}
\usepackage{mathtools}
%\usepackage{caption}
%\usepackage{subcaption}
%\usepackage{cite}
\usepackage{hyperref}
\usepackage{url}
\urlstyle{same}
\newcommand{\keywords}[1]{\par\addvspace\baselineskip
\noindent\keywordname\enspace\ignorespaces#1}

%\makeatletter
%\let\c@lemma=\c@theorem
%\let\c@corollary=\c@theorem
%\let\c@fact=\c@theorem
%\makeatother
%
%\let\realendproof=\endproof
%\def\endproof{\hspace*{\fill}$\Box$\realendproof}
\newtheorem{conj}[theorem]{Conjecture} 
\title{Self Referencing Sequences}
\author{Perry Kleinhenz, Fermi Ma and Erik Waingarten}
\date{}							% Activate to display a given date or no date

\begin{document}

\title{Self Referencing Sequences}
\titlerunning{Self Referencing Sequences}

\author{Perry Kleinhenz \and Fermi Ma \and Erik Waingarten}
%
\authorrunning{Perry Kleinhenz \and Fermi Ma \and Erik Waingarten}
% (feature abused for this document to repeat the title also on left hand pages)

% the affiliations are given next; don't give your e-mail address
% unless you accept that it will be published
\institute{
\protect\url{{pkleinhe, fermima,eaw}@mit.edu}}

\maketitle

\section{Introduction}

\emph{Written by Fermi Ma, edited by Perry Kleinhenz and Erik Waingarten}

In this paper we study sequences which are self-referencing. That is, the numbers in the sequence in some way correspond to previous numbers in the same sequence. In particular, we will analyze self-referencing sequences with respect to block lengths. Consider the sequence
\begin{equation}
\label{eq:onetwo}
1,2,2,1,1,2,1,2,2,1,2,2,1,1,2,1,1,2,2,\dots
\end{equation}
We can break up the sequence into contiguous blocks, where each block is a stretch of repeated numbers:
\begin{figure}
\label{fig:sequenceblocks}
\center
\includegraphics[width=0.4\linewidth]{sequenceBlocks}
\caption{Sequence broken up into contiguous blocks with lengths generating same sequence.}
\end{figure}

The block lengths, read from left to right, reproduce the original sequence (see Figure~\ref{fig:sequenceblocks}). We call such a sequence \emph{self-referential}. 

In our example above each block is composed of either $1$'s or $2$'s. When a self referential sequence can only take two possible numbers the number a new block should begin with is unambiguous; the numbers simply alternate. For instance in our example above after a block of 1's, the next block must be a block of 2's, then again 1's, and so on. However if our sequence was composed of $1$'s, $2$'s and $3$'s there would be ambiguity over which number a new block should begin with. 

For example if the first number is 1, then we could make the second number either a 2, or a 3. In particular, both:
\begin{equation}
1, 3, 3, 3, 2, 2, 2, \dots
\end{equation}
\begin{equation}
1, 2, 2, 1, 1, 3, 1, \dots\\
\end{equation}
are self-referential sequences.
Each time we need to specify a new block, we have a choice of two elements. We would like to avoid having a large number of choices in the generation of the sequence, and so we will give an order to the elements a sequence will contain, and write it as a cycle. 
For example, self-referencing sequences with elements from the cycle $(123 )$ contain the elements 1, 2, and 3 and will have the order $1 \rightarrow 2 \rightarrow 3 \rightarrow 1$. 

With this rule, the self-referencing sequence generated by $(123)$ that begins with a $1$ is shown in Figure 2 %~\ref{fig:onetwothree}.
\begin{figure}
\label{fig:onetwothree}
\center
\includegraphics[width=0.4\linewidth]{sequenceBlocks123}
\caption{Sequence generated by $(123)$ broken up into contiguous blocks with lengths generating same sequence.}
\end{figure}

We call the cycle the self-referential sequence is generated over the \emph{generating cycle}.

Our main results are:
\begin{itemize}
\item The self-referencing sequence for a given generating cycle is uniquely determined by its first number.
\item In order to establish long term equivalence of two sequences it is enough to check only finitely many terms 
\item For some generating cycles there exists an equivalent formulation of self-referencing sequences using substitution rules.
\item If a generating cycle has substitution rules then one can compute the limiting density for the numbers in the sequence if such a limiting density exists.
\item The limiting densities of the self-referencing sequences of $(13)$ if such densities exists.
\end{itemize}

In Section~\ref{determinism} we show that if we are given a generating cycle and a starting number for the sequence, the sequence is uniquely determined. In Section~\ref{equivalence}, we consider the limiting behavior of such sequences and show when the limiting behavior of two sequences is the same. 

In Section~\ref{iterativeprocess}, we give an iterative process that generates self-referencing sequences. In Section~\ref{substitutionrules}, we show how a large number of these sequences can actually be generated with a simple set of substitution rules. We introduce the density problem in Section~\ref{densitycomputation}, and use ideas developed in Section~\ref{iterativeprocess} and Section~\ref{substitutionrules} to answer the question for certain types of generating cycles. In Section ~\ref{densitybounds}  we consider the open problem of determining the density of the sequences generated by $(12)$ and find it hard to solve using our methods.

\section{Determinism}
\label{determinism}

\emph{Written by Fermi Ma, edited by Perry Kleinhenz and Erik Waingarten}

We claim that a self-referencing sequence is uniquely determined by the generating cycle $C$ and the starting number $c \in C$. We will prove this by showing that if we are given the first number of the sequence, there is only one way to extend the sequence. In order to do this, we formalize the idea of breaking up a sequence into blocks.

\begin{definition}
A block $B$ is any maximal length subsequence of repeated numbers in a sequence. We denote by $B_i$ the $i$th block of the sequence.
\end{definition}

Here, \emph{maximal length} is a local property that means that the block cannot be extended to include the numbers preceding or succeeding the block, as they will not be the repeated number. Thus, if a sequence $\{a_i\}$ is
\begin{align*}
1,3,3,3,1,1,1,3\dots \,
\end{align*}
the first block is $B_1 = \{1\}$, the second is $B_2 = \{3,3,3\}$, the third is $B_3 = \{1,1,1\}$, and so on. 

Clearly, a sequence can be specified by giving the numbers of the sequence individually, or by specifying all the blocks $B_i$. This is enough to make the following claim:

\begin{proposition}
A self-referencing sequence $\{a_i\}$ is uniquely specified by the generating cycle $C$ and the starting number $c \in C$. In other words, such an $\{a_i\}$ is guaranteed to exist and is unique.
\end{proposition}
\begin{proof} 
The proof is constructive. The self-referential property of the sequence implies that the contents of block $B_i$ are entirely determined by the values of $c$, $i$, and $a_i$. The value of $i$ determines which number is repeated throughout the block. For example, when $i = 1$, the number is the starting number $c$, and when $i = 2$, we use the number following the starting number in $C$, and so on for larger values of $i$. The value of $a_i$ simply dictates the length of block $B_i$.

Thus, the sequence is uniquely given by first ``writing down" $B_1$, followed by $B_2$, followed by $B_3$, etc. One detail is that it remains to check that $a_i$ is known when $B_i$ is written down. However, writing down a block always involves writing down at least one element of the sequence, so the value of $a_i$ is always known when $B_i$ is written down. Note that there is an edge case where $a_i$ is not yet written down if the starting number is 1 and $i =2$. However, in this case, the value of $a_i$ is still known (as it is given by the rule) and thus $B_i$ can still be written down.
\end{proof}

From this point on, we will denote by $s(C,a)$ the unique sequence with generating cycle $C$ and with starting number $a \in C$.

\section{Equivalence}
\label{equivalence}
\emph{Written by Fermi Ma and Perry Kleinhenz, edited by Erik Waingarten}

In this section, we consider equivalence of the limiting behavior of sequences. We introduce a formal definition of this and establish results that allow us to determine when two sequences are equivalent.  

We first make a formal definition of equivalence. 
\begin{definition}
We say that two sequences $\{a_i\}$ and $\{b_i\}$ are equivalent if there exist integers $n, k \geq 0$ such that 
\begin{align*}
a_{n+i} = b_{k+i}, \quad i=1,2,3,\ldots \ .
\end{align*}
\end{definition}
Note that two sequences can only be equivalent if they are generated by the same cycle.

As a basic example of equivalence, consider sequences generated by $C = (123)$. The sequence which starts with a 2 is 
\begin{align*}
2,2,3,3,1,1,1,2,2,2,3,1,2,3,3,1,1,2,2,3,3,3,\dots \ ,
\end{align*}
and the sequence that starts with a 3 is 
\begin{align*}
3,3,3,1,1,1,2,2,2,3,1,2,3,3,1,1,2,2,3,3,3,\dots \ .
\end{align*}
If we delete the first two numbers of the sequence starting with 2, and the first number of the sequence starting with 3, as follows
\begin{align*}
2,2,&|3,3,1,1,1,2,2,2,3,1,2,3,3,1,1,2,2,3,3,3,\dots\\
3,&|3,3,1,1,1,2,2,2,3,1,2,3,3,1,1,2,2,3,3,3,\dots \ ,
\end{align*}
we see that the resultant sequences are the same, and thus the original sequences are in some sense equivalent. At an intuitive level, it seems obvious that these two truncated sequences are identical since they begin with the same two numbers and the numbers which were removed do not refer to blocks to the right of these numbers. We now formalize this intuition for claiming that two sequences are in fact equivalent.

To do this, we first introduce the \emph{read distance}.
\begin{definition} Consider a sequence $\{a_i\}$. The read distance for an index $i$ is the difference $index(B_i) - i$, where $index(B_i)$ is the index of the first number in the $i$th block $B_i$ of numbers.
\end{definition}
Note that the read distance can be any nonnegative integer. For example if we again consider the sequence generated by $C = (1 2 3)$ that starts with a $2$
\begin{align*}
2,2,3,3,1,1,1,2,2,2,3,1,2,3,3,1,1,2,2,3,3,3,\dots \ ,
\end{align*}
the read distance for index 1 is $index(B_1) - 1 = 1 - 1 = 0$. The read distance for index 2 is $index(B_2) - 2 = 3 - 2 = 1$. We can continue to calculate the read distances at each index of this sequence and we see that they form a monotonically increasing sequence 
\[ 0,1,2,4,6,6,6,6,7,8,9,\ldots \]

This monotonicity is present in sequences other than ones generated by $(123)$. We can explain this monotonicity phenomenon with the following proposition.
\begin{proposition} 
\label{readdistformula}
Let $\{a_i\}$ be any self-referencing sequence generated by some cycle of positive integers. Then the read distance for index $j$ is 0 if $j =1$, and when $j>1$, the read distance is
\begin{equation*}
\sum_{k=1}^{j-1}( a_k - 1).
\end{equation*} 
\end{proposition}
\begin{proof}
We prove this using induction. We know that for $i=1$, the read distance is $0$ as the first block always starts at the first number. When $i=2$, the read distance is $a_1-1$. The first block will be of length $a_1$ since the sequence is self referencing, therefore the second block will begin at index $a_1+1$. So the read distance is $index(B_2) - 2 = a_1 -1$.

For the inductive step, suppose the formula holds for $i=l > 1$. This means that the read distance of index $l$ is
\begin{equation*}
index(B_l) - l = \sum_{k=1}^{l-1}( a_k - 1).
\end{equation*} 
The $l$th block has length $a_l$, which implies that $index(B_{l+1}) - index(B_l) = a_l$. Thus, the read distance of index $l+1$ is
\begin{align*}
index(B_{l+1}) - (l+1) = a_l - 1 + \sum_{k=1}^{l-1} (a_k-1) = \sum_{k=1}^{l} (a_k-1),
\end{align*}
which compeltes the induction.
\end{proof}
Note that because $\{a_i\}$ is generated by positive integers, we always have $a_k-1\geq 0$ and so the read distance increases monotonically. 

%Although this shows us that read distance never decreases it does not tell us how quickly it increases, our next result gives a simple bound on the number of consecutive times the read distance can stay constant. 
%\begin{corollary} Consider a self referencing sequence $\{a_i\}$ generated by $(c_1 c_2 \ldots c_n)$ with $m = \max(c_1, c_2, \ldots, c_n)$. Suppose the read distance for $i$ is $d$, then the read distance for $i+m$ is at least $d+1$. 
%\end{corollary}
%\begin{proof}
%The read distances can stay constant from $i$ to $i+1$ only if there is a $a_{i+1} = 1$. There can be at most $m$ 1's in a contiguous block, so the read distance of $i+m$ is bigger than the read distance of $i$.  
%\end{proof}

Now that we have a closed-form expression for the read distance at a given index, we prove our first major result: we can check only finitely many indices in order to establish that two sequences are equivalent.
\begin{theorem} 
\label{equivsuff}
Let $\{a_i\}, \{b_i\}$ be two self-referencing sequences generated by the same cycle. If there exist integers $m,l$ such that the read distances for $a_m$ and $b_l$ are both equal to $d$ and 
\begin{equation*}
a_{m+k} = b_{l+k}, \quad 0 \leq k \leq d-1,
\end{equation*}
then $\{a_i\}$ and $\{b_i\}$ are equivalent. 
\end{theorem}

\begin{proof}
We will proceed by contradiction, so first assume otherwise. That is, assume there exists some $j \geq d$ such that 
\begin{equation*}
a_{m+j} \neq b_{l+j}
\end{equation*}
but 
\begin{equation*}
a_{m+k} = b_{l+k}
\end{equation*} 
for all $0 \leq k < j$. 

Since the two sequences are both generated by the same cycle, this implies that either $a_{m+j}$ or $b_{l+j}$ is part of the same block as the element proceeding it, while the other is not.
Without loss of generality we will assume that $a_{m+j}=a_{m+j-1}$ and $b_{l+j} \neq b_{l+j-1}$. 

The length of the block that $a_{m+j-1}$ is a part of is $a_{m+n}$, for some $0 \leq n < j-1$. Because the two sequences are identical for $0 \leq k<j$ and by our assumption that the read distance is the same for $a_{m}$ and $b_{l}$, the read distance for $b_{l+n}$ equals the read distance for $a_{m+n}$. This combined with the fact that $a_{m+n} = b_{l+n}$ shows that the block containing $a_{m+j-1}$ must be of the same length as the block containing $b_{l+j-1}$.

Since the two sequences are the same for $0 \leq k<j$, the number of elements in the block containing $a_{m+j-1}$, with $k<j$, and the number of elements in the block containing $b_{l+j-1}$, with $k<j$, must be the same. Because $a_{m+j}$ is part of the same block as the element preceding it, this means that $b_{l+j}$ must be a part of the same block as the element proceeding it as well. 
This contradicts the fact that exactly one of the two elements is not in the same block as the element preceding it and so the two sequences must be equivalent. 

%We will prove this by  induction. In particular we will show for all $k \geq 0$ that $a_{m+k} = b_{l+k}$ and the read distance for $a_{m+k}$ equals the read distance for $b_{l+k}$. By our assumptions we already have this for $0 \leq k \leq d-1$ and so we begin with $k=d$.

%Since a new block begins at $a_{m+d}$ and $b_{l+d}$ and $a_{m+d-1} = b_{l+d-1}$ we have $a_{m+d} = b_{l+d}$. Furthermore, by Lemma ~\ref{readdistformula} we have that the read distance for $a_{m+d}$ equals the read distance for $b_{l+d}$. 

%Now suppose that  for $k \leq j$ we have $a_{m+k} = b_{l+k}$ and the read distance for $a_{m+k}$ equals the read distance for $b_{l+k}$. We would like to show that this holds for $k = j+1$. By Lemma ~\ref{readdistformula} we actually already know that the read distance for the two is the same, as it is the same for the preceding terms, which are equal.

%If $a_{m+k}$ is the last term in a block then $b_{m+k}$ must also be the last term in its block, because the length of blocks is determined by earlier terms which we know to be equal and to have the same read distance. Since $a_{m+k} = b_{l+k}$  in this case we have $a_{m+k+1} = b_{l+k+1}$. 

%sOtherwise $a_{m+k}$ and $a_{m+k+1}$ are in the same block, and so we only need to show that $b_{l+k}$ and $b_{l+k+1}$ are in the same block as well. But as we argued above the length of blocks is determined by terms earlier in the sequence, which we know to be equal and have the same read distance. Therefore we have $a_{m+k+1} = b_{l+k+1}$ for this case as well. This completes our induction and so $\{a_i\}$ and $\{b_i\}$ are equivalent. 
\end{proof}

This result also allows us to make a general statement regarding equivalence of sequences that begin with a $1$.
\begin{corollary} If $C = (1 c_1 c_2 \cdots c_n)$, then $s(C, 1)$ and $s(C, c_1)$ are equivalent.
\end{corollary}
\begin{proof}
Let $\{a_i\} = s(C, 1)$ and $\{b_i\} = s(C, c_1)$. The read distance of sequence $\{a_i\}$ for $i=2$ is 0, and the read distance of sequence $\{b_i\}$ for $i = 1$ is 0. In addition, $a_2 = b_1 = c_1$, so by Theorem ~\ref{equivsuff} the two sequences are equivalent.
\end{proof}
Note that one can check this corollary easily by hand, but our formalism provides a way to mathematically verify this intuition.

We can also demonstrate a necessary condition for equivalence. 
\begin{theorem}
\label{thm:readfirst}
If two sequences are equivalent, then the first element of the shared sequence must have the same read distance in both sequences.
\end{theorem}

\begin{proof}
Suppose the two sequences are $\{a_j\}$ and $\{b_j\}$ and we have 
\begin{equation*}
a_{m+i} = b_{l+i} = c_{i} \quad 1 \leq i
\end{equation*}
such that if $m$ or $l$ were made smaller this relation would not hold. We will proceed by contradiction so assume that the read distance for $a_{m+1}$ is $x$ and the read distance for $b_{l+1}$ is $y$ such that $x<y$.

%Since the two sequences are equivalent the block that begins at index $m+x+1$ in $\{a_i\}$ begins at index $l+x+1$ in $\{b_i\}$. The element which refers to this block in $\{b_i\}$ must appear before the index $l+1$, because the element at index $l+1$ refers to the block beginning at $l+y+1$ and read distance is non-decreasing. Furthermore this element of $\{b_i\}$ must have the same value as $a_{m+1}$, because the two blocks are of the same length.  

Since the two read distances are different, we know there are two separate blocks of length $c_1$ in the common sequence, one which corresponds to $a_{m+1}$ and another which corresponds to $b_{l+1}$. Note that the block corresponding to $b_{l+1}$ is to the right of the block corresponding to $a_{m+1}$ because the read distance for $b_{l+1}$ is larger. Now because $\{a_i\}$ is self-referential, there exists some index $n$ such that $a_{m+n+1}$ is the element of $\{a_i\}$ which corresponds to the second block of length $c_1$. 

We claim that
\begin{equation*}
c_i = b_{l-n+i} \quad 1 \leq i \leq n.
\end{equation*}
That is, the subsequence $c_1, c_2, \ldots, c_{n}$ appears in $\{b_i\}$ such that the last term is next to the beginning of the common sequence. This is true because the length of the blocks of $\{c_i\}$ which occur before the second block of length $c_1$ must appear as terms of $\{b_i\}$ and must end next to the number which refers to the second block of length $c_1$.

Thus our sequence $\{b_i\}$ is  
\begin{equation*}
\cdots c_1 c_2 \cdots c_{n} c_1 c_2 \cdots c_n \cdots \ ,
\end{equation*}
where the beginning of the common sequence is the second $c_1$. We now claim that the common sequence is just the subsequence
\begin{equation*}
c_1 c_2 \cdots c_n,
\end{equation*}
repeated an infinite number of times. 

Since the read distance for $b_{l+1}$ is greater than the read distance for $a_{m+1}$, and the sequences are identical for subsequent indices, by Lemma ~\ref{readdistformula} we know that the read distance for $b_{l+i}$ is larger than the read distance for $a_{m+i}$ by exactly $y-x$. 

Thus $b_{l+i}$ and $a_{m+(y-x)+i}$ correspond to the same block. But $b_{l+i} = c_{i}$ and $a_{m+(x-y)+i}=c_{x-y+i}$. Therefore $c_{i} = c_{y-x+i}$ and so the common sequence repeats. 

Because the common sequence repeats and $\{b_i\}$ has the same cycle, but one which begins before the common sequence, $l$ could be made smaller and have the equivalence relation hold. This contradicts our statement that $l$ is as small as possible. Therefore the first element of the shared sequence must have the same read distance in both sequences. 
\end{proof}

\begin{corollary}
If two self-referencing sequences are generated over the same cycle and are equivalent, then the read distance of their shared subsequence is the same everywhere.
\end{corollary}

\begin{proof}
This follows from Theorem~\ref{thm:readfirst} and Lemma~\ref{readdistformula}.
\end{proof}

It is unclear whether all sequences generated by the same cycle are equivalent. This is certainly the case for $C=(123)$ and any two element cycles, but we have been unable to generalize this to other three element or larger cycles. A key ingredient in establishing a counterexample would be more stringent necessary conditions for equivalence, but it is unclear what these conditions should be or how to prove they are necessary. If we want to establish that all sequences generated by the same cycle are in fact equivalent, we would need weaker or more generalizable sufficient conditions for equivalence. 

\section{An Iterative Process}
\label{iterativeprocess}

\emph{Written by Fermi Ma and Perry Kleinhenz edited by Erik Waingarten}

We change focus in this section and consider how to generate self-referential sequences with an iterative process. We first look at the sequences generated by the cycle $C = (1 2)$.

One possible iterative process is as follows. Let the sequence $s^0$ be 2, and let the sequence $s^{(i)}$ for $i \geq 1$ be the unique sequence that starts with 2 and is such that its block lengths, read from left to right, reproduce the sequence $s^{(i-1)}$. This gives:
\begin{align*}
s^{(0)}&= 2\\
s^{(1)} &= 22\\
s^{(2)} &= 2211\\
s^{(3)}&= 221121\\
s^{(4)} &= 221121221\\
&\vdots
\end{align*}
We define the limit of this process, the sequence $s^{\infty}$ as 
\begin{equation*}
s_{j}^{\infty} = \lim_{i \rightarrow \infty} s_{j}^{(i)}.
\end{equation*}
We claim that this $s^{\infty}$ exists and is the unique self-referential sequence $s(C,2)$. In fact we can prove a more general result about this iterative process.

Before we do so however we will give two different notions of convergence that will allow us to state our result more precisely. 
\begin{definition} We say that a sequence $s^{(i)}$ is weakly convergent to $s(C,a)$ if $s^{\infty}$ exists and $s^{\infty} = s(C,a)$. We say that the sequence $s^{(i)}$ is strongly convergent to $s(C,a)$ if $s^{(i)}$ is a prefix of $s(C,a)$ for all $i \geq k$ for some $k\geq 0$. 
\end{definition}
Note that all strongly convergent sequences are also weakly convergent. We can now show that if we specify a generating cycle, any length 1 starting sequence $s^0$ (other than $1$) is strongly convergent to the self referencing sequence that begins with the element.

\begin{proposition}
\label{iteratetheorem}
Let $C$ be some generating cycle. Let $s^{(0)} = a$ for some $a \in C$ where $a \neq 1$, and let $s^{(i)}$ be the sequences generated by the iterative process. Then $s^{(i)}$ is strongly convergent to $s(C,a)$.
\end{proposition}

\begin{proof}
This claim is straightforward, but we will formally prove it with induction on $i$. We show that if $s^{(i)}$ is a prefix of $s(C,a)$, then $s^{(i+1)}$ is a longer prefix of $s(C,a)$. The base case of the induction is satisfied, as $s^{(0)}$ is a prefix of $s(C,a)$.

For the inductive step, we observe that a prefix of the sequence describes the block lengths of a \emph{longer} prefix of the sequence. We know that the sequence it describes is longer because the length of $s^{(i+1)}$ equals the sum of of the numbers in $s^{(i)}$, which is strictly greater than the length of $s^{(i)}$. We know that the sequence it describes is a prefix, since the first number matches up with $s(C,a)$, and so do the block lengths. This completes the induction.
%
%%The resultant sequence is a prefix of the self referencing sequence because if we apply our process to any prefix of the self referencing sequence it will produce a prefix of the self referencing sequence. 
%
%Since very $s^{(i)}$ is a prefix of $s(C,a)$, we know that once $s^{(i)}_{j}$ has been assigned a value, $s^{(k)}_{j}$ will have the same value for all $k \geq i$. Because of this the limit is well defined and so $s^{\infty}$ exists. As the limit of the process we know that $s^{\infty}$ is a prefix of $s(C,a)$, but since at every step of the process the length of the sequence strictly increases we must have that $s^{\infty}$ has infinite length, and so $s^{\infty} = s(C,a)$. 
\end{proof}

Note that we must specify that $a \neq 1$, because otherwise $s^{(i)}$ is always $1$, and so the length of the sequence does not grow.  

Above we only considered starting sequences which have length one,  but we would like to consider arbitrary starting sequences. Going back to the case of $C = (1 2)$, we can let $s^{(0)}$ be \emph{any} sequence of 1's and 2's that starts with a 2 and the limiting sequence will still be the self-referential sequence.
For example, suppose $s^{(0)} = 2,1,1,1,2$. The rules for generating $s^{(i)}$ give:
\begin{align*}
s^{(0)}&= 2,1,1,1,2\\
s^{(1)} &= 2,2,1,2,1,2,2\\
s^{(2)} &= 2,2,1,1,2,1,1,2,1,1,2,2\\
s^{(3)} &= 2,2,1,1,2,1,2,2,1,2,1,1,2,1,2,2,1,1\\
&\vdots
\end{align*}
We claim that $s^\infty = s(C,a)$, which we state as the following corollary.

\begin{corollary}
Let $C$ be some generating cycle, let $s^{(0)}$ be any sequence of elements of $C$ which begins with some $a \in C$ such that $a \neq 1$. Then $s^{(i)}$ is weakly convergent to $s(C,a)$. 
\end{corollary}
\begin{proof} 
This follows directly from Proposition \ref{iteratetheorem}. That is because $s^{(0)}$ begins with an $a$, at each step of the process $s^{(i)}$ will be a prefix of $s(C,a)$ followed by some terms that disagree with $s(C,a)$. In the limit the prefix of $s(C,a)$ becomes $s(C,a)$ and so $s^{\infty} = s(C,a)$.
\end{proof}
Note that we do not guarantee strong convergence as there are some starting sequences, such as $2222$, which in numerical simulation appears to produce sequences which disagree with the $s( (12), 2)$ on a constant fraction of indices. We would like to be able to produce a general result that distinguishes between strongly and weekly convergent subsequences but it is unclear that there is a nice categorization of them. 

%
%\begin{conj} Let $C = (1,2)$. A sequence $s^{(i)}$ is weakly convergent but not strongly convergent to $s(C, a)$ if the starting sequence begins with an $a \in \{1,2\}$ and contains 4 or more elements.
%\end{conj} 
%We make this conjecture on the basis on computer simulations which executes the iterative process to at least 20 iterations. More iterations were not completed because after this point the simulations began to take impractically long amounts of time to complete. 

\section{Substitution Rules}
\label{substitutionrules}

\emph{Written by Fermi Ma and Erik Waingarten, edited by Perry Kleinhenz}

The iterative process given in Section~\ref{iterativeprocess} is one way to generate self-referencing sequences. However, for certain generating cycles $C$, there is a simpler way to perform this iteration using a fixed set of substitution rules. Take $C = (1 3)$ as an example, and consider the sequence that starts with a 3:
\begin{align*}
333111333131333111333\dots
\end{align*}
We can use the iterative process from Section~\ref{iterativeprocess}, and suppose that $s^{(0)} = 33$. We get:
\begin{align*}
\{s^{(0)}\} &= 3,3\\
\{s^{(1)}\} &= 3,3,3,1,1,1\\
\{s^{(2)}\} &= 3,3,3,1,1,1,3,3,3,1,3,1\\
\{s^{(3)}\} &= 3,3,3,1,1,1,3,3,3,1,3,1,3,3,3,1,1,1,3,3,3,1,3,3,3,1\\
&\cdots
\end{align*}
It turns out that we can model this evolution with the following substitution rules:
\begin{align*}
\text{Rule }1: 3,3 &\to 3,3,3,1,1,1 \\
\text{Rule }2: 3,1 &\to 3,3,3,1\\
\text{Rule }3: 1,1 &\to 3,1
\end{align*}
This is to be interpreted as follows. Starting from 3,3, the only possible rule to apply is Rule 1, which gives $3,3,3,1,1,1$ at the following iteration. We then apply Rule 1 to $3,3$, Rule 2 to $3,1$ and Rule 3 to $1,1$. Note that at every step, we break up the sequence into chunks of 2 and then simultaneously apply \emph{all} the rules. This will always be possible, since the rules preserve the fact that these sequences have even length. So at the following step, we have 3,3,3,1,1,1,3,3,3,1,3,1, which is $s^{(2)}$. Notice that in general, after the $i$th application of the substitution rules, the sequence is equal to $s^{(i)}$.

We can formulate a set of sufficient conditions for rules that generate the self-referencing sequences.

\textbf{Reader's Note:} The following formalism might be hard to follow, but the general idea of the formalism states that we should do what we did in the $C = (13)$ case. In that example, we wrote down all possible rules that transform strings of a certain length (2), such that each rule was self referential (the input to the rule specifies the block lengths of the output to the rule).

\begin{proposition}
\label{ruleprop}
Suppose $C$ is a generating cycle. Fix a length $l$ that is divisible by $|C|$ as well as some $a \in C$. Then for all possible substrings $x$ (using numbers in $C$) of length $l$, write down the unique rule, if it exists, of the form $x \to y$ that satisfies the following properties:
\begin{enumerate}
\item $x$ is the sequence of the block lengths of $y$.
\item $y$ starts with $a$
\item $|y|$ is divisible by $l$.
\end{enumerate}
If any string $x$ does not have a corresponding $y$ that satisfies the above properties, then the rule set does not work. If we can write down a rule for each $x$, then successively applying these rules to a starting sequence length $l$ will give sequences that weakly converge to $s(C,a)$.
\end{proposition}

\begin{proof}
Let $s^{(i)}$ be the sequence generated by the iterative process from Section~\ref{iterativeprocess} given some starting sequence $s^{(0)}$ of length $l$. We show by induction on $i$ that applying the above rules to the same starting sequence simulates the iterative process. 

The base case is trivially satisfied, since we start with the same starting sequence $s^{(0)}$ in both the iterative process and this substitution process.

For the inductive step, suppose that applying the rules in $i$ times to $s^{(0)}$ gives $s^{(i)}$, the sequence given at the $i$th step of the iterative process. Note that $|s^{(i)}|$ is divisible by $l$ since each iteration applies the rule to a segment of length $l$ and by condition 3, it writes a sequence of length a multiple of $l$. So we can partition $s^{(i)}$ uniquely into disjoint chunks of size $l$. 

In the iterative process, each subsequence of size $l$ ``generates" $l$ blocks at the next iteration, and since $|C|$ divides $l$, the block referenced by each of these subsequences will start with the same number the subsequence started with. Additionally, since all the rules begin with $a$, this number will be $a$.  

So applying the rules to each chunk is equivalent to applying the iterative process, where we group elements into subsequences of size $l$. Therefore, $s^{(i+1)}$ is the result of applying the rules to $s^{(i)}$.
\end{proof}

Given Proposition~\ref{ruleprop} we can generate rules a large class of generating cycles $C$. Take the following example, where $C = (2 4)$, and the rules are
\begin{align*}
\text{Rule }1: 2,2 &\to 2, 2, 4, 4 \\
\text{Rule }2: 2,4 &\to 2, 2, 4,4,4,4\\
\text{Rule }3: 4,2 &\to 2,2,2,2,4,4\\
\text{Rule }4: 4,4 &\to 2, 2, 2, 2, 4, 4, 4, 4.
\end{align*}
These rules satisfy the conditions of Proposition~\ref{ruleprop}, and so successive application of these rules will generate a self-referencing sequence which is weakly convergent to $s(C, 2)$. 

Unfortunately, this proposition will not help us resolve the density problem for $C = (12)$.

\begin{proposition}
\label{norules12}
There is no set of rules $R$ satisfying the conditions of Proposition~\ref{ruleprop} for $C=(12)$.
\end{proposition}

\begin{proof}
Suppose $l$ is a positive integer. Then, by our definition of $l$ in Proposition~\ref{ruleprop}, $l$ must be even. Let $s$ be the string with one 2 and $l-1$ 1's. Suppose $x \rightarrow y$ is the rule for $s$, so $x = s$. Then by condition 1 of Proposition~\ref{ruleprop}, $|y| = l+1$, so $|y|$ is odd, but then it is not divisible by $l$, as condition 3 requires. This is a contradiction.
\end{proof}

\section{A Density Computation}
\label{densitycomputation}
\emph{Written by Erik Waingarten and Fermi Ma, edited by Perry Kleinhenz}

We consider the idea of density, which is the proportion of a self-referential sequence that is equal to a certain number. We build off of the substitution rules discovered in the previous section to study the densities in sequences with generating cycle $C = (1 3)$ (note that the sequence that starts with a 1 differs by only one number from the sequence that starts with a 3, so we do not need to consider them separately). While we cannot prove that a limiting density exists, we give a numerical calculation of what the density is \emph{if it exists}. We use a general technique that takes advantage of the fact that substitution rules when $C = (1 3)$, as shown in Section~\ref{substitutionrules}.

In Section~\ref{substitutionrules}, we found that repeated applications of the rules
\begin{align*}
\text{Rule }1: 3,3 &\to 3,3,3,1,1,1 \\
\text{Rule }2: 3,1 &\to 3,3,3,1\\
\text{Rule }3: 1,1 &\to 3,1
\end{align*}
to the initial sequence $\{3,1\}$ gives a growing sequence that converges to the self-referential sequence $s((1 3),3)$. 

If we let $A$ denote the subsequence $\{3,3\}$, $B$ denote $\{3,1\}$ and let $C$ denote $\{1,1\}$, then the rules can be rewritten as
\begin{align*}
\text{Rule }1: A &\to ABC \\
\text{Rule }2: B &\to AB\\
\text{Rule }3: C &\to B,
\end{align*}
where AB and ABC are to be interpreted as concatenations of the subsequences.

Our technique for computing densities will work as follows. Let $N_i(A), N_i(B),$ and $N_i(C)$ denote the number of $A$'s, $B$'s, and $C$'s, respectively, in the sequence given by the $i$th application of the substitution rules. We keep track of these counts of $A$'s, $B$'s, and $C$'s at each round of rule applications, and we use these to determine limiting proportions of $A$'s, $B$'s and $C$'s. From these limiting proportions, we can deduce the densities of 1's and 3's. 

To start, consider the substitution process from the very first step. We start applying substitution rules to the initial sequence $\{3,1\}$. Since $\{3,1\} = B$, the initial counts are:
\[\text{Sequence at step }1: \{3,1\},\text{ Counts}: N_1(A) = 0, N_1(B) = 1, N_1(C) = 0.\]

After one application of the substitution rules, we have
\[\text{Sequence at step }2: \{3,3,3,1\},\text{ Counts}: N_2(A) = 1, N_2(B) = 1, N_2(C) = 0.\]

After one more application, we have
\[\text{Sequence at step }3: \{3,3,3,1,1,1,3,3,3,1\}, \text{ Counts}: N_3(A) = 2, N_3(B) = 2, N_3(C) = 1.\]

For the purposes of computing densities, it turns out that only the counts are relevant and we do not need to keep track of the sequence at each step. We can compute the counts $N_i$ from the values of $N_{i-1}$ as follows
\begin{align*}
N_i(A) &= N_{i-1}(A) + N_{i-1}(B)\\
N_i(B) &= N_{i-1}(A) + N_{i-1}(B) + N_{i-1}(C)\\
N_i(C) &= N_{i-1}(A).
\end{align*}
The above equations are arrived at by looking at the set of rules involving $A,B,$ and $C$. For example, an $A$ at the $i$th iteration is written down every time there is an $A$ or $B$ in the previous iteration, which leads to the first equation above.

For computing densities, however, the \emph{proportions} of $A$'s, $B$'s, and $C$'s are needed. Fortunately, we can derive equations for the proportions by simply normalizing the equations for the counts. Let $P_i(X)$ denote the proportion of the sequence after iteration $i$ that is made up of the $X$ subsequence. Normalizing gives the following equations:
\begin{align*}
P_i(A) &= \frac{P_{i-1}(A) + P_{i-1}(B)}{3P_{i-1}(A) + 2P_{i-1}(B) + P_{i-1}(C)}\\
P_i(B) &= \frac{P_{i-1}(A) + P_{i-1}(B) + P_{i-1}(C)}{3P_{i-1}(A) + 2P_{i-1}(B) + P_{i-1}(C)}\\
P_i(C) &= \frac{P_{i-1}(A)}{3P_{i-1}(A) + 2P_{i-1}(B) + P_{i-1}(C)}.
\end{align*}
The only difference is that each equation is divided on the right-hand side by $3P_{i-1}(A) + 2P_{i-1}(B) + P_{i-1}(C)$ to ensure that the proportions of $A$'s, $B$'s, and $C'$s at each step add up to 1. Now, assume that there exist limiting proportions (and hence, limiting densities) as $i \to \infty$. Then at this limit, $P_i(X) = P_{i-1}(X) = P_{\infty}(X)$. Making these substitutions and solving for $P_{\infty}(A), P_{\infty}(B),$ and $P_{\infty}(C)$ in \texttt{Mathematica} gives the following values:
\begin{align*}
P_{\infty}(A) &\approx \texttt{0.3760858894420931}\\
P_{\infty}(B) &\approx \texttt{0.4533976515164037}\\
P_{\infty}(C) &\approx \texttt{0.1705164590415032}.
\end{align*}

Since $A = \{3,3\}$, $B = \{3,1\}$ and $C = \{1,1\}$, the fraction of 1's in the limiting sequence is $0.5P_{\infty}(B) + P_{\infty}(C)$, and the fraction of 3's in the limiting sequence is $P_{\infty}(A) + 0.5P_{\infty}(B)$. So the density values, if they exist, are
\begin{align*}
&\text{Fraction of 1's: }\texttt{0.397215284799705}\\
&\text{Fraction of 3's: }\texttt{0.602784715200295}.
\end{align*}
We were able to support these calcuations with numerical simulations. We generated the $s((13),3)$ sequence using the iterative method to 20 iterations, and we found that the fraction of 1's was approximately $0.397$, and that the fraction of 3's was approximately 0.603.

It is difficult to fully generalize this procedure for all substitution rule sets, as we cannot prescribe a general form for all substitution rules. However, we believe that this technique should work whenever all the inputs to the substitution rules are the same length (in this case, the inputs were all length 2), and the outputs are all lengths that are multiples of the inputs. We do not know if the resulting equations will always give exactly 1 solution, as they did in this case.

\section{Density Bounds for $C = (12)$}
\label{densitybounds}
\emph{Written by Erik Waingarten, edited by Fermi Ma and Perry Kleinhenz}

As discussed in the Section~\ref{substitutionrules}, it is unclear how to establish a set of rules for $C = (1 2)$. However, there is some structure that we can exploit. In particular, we know that the sequences $1, 1, 1$ and $2, 2, 2$ will never appear in the self-referential sequence. This is because such sequences either imply the existence of a 3 earlier in the sequence, or make up the first block of the sequence. Neither option is possible.

This simple observation implies that if there is a limiting density of $1$'s and $2$'s, then that density $d_2$ is bounded between 
\[ \dfrac{1}{3} \leq d_2 \leq \dfrac{2}{3} \]

So we know there must be at least one $2$ for every three consecutive terms of the sequence. We can ask  the following similar question: how many $2$'s are in any consecutive substring of length $9$? The answer is (trivially) at least 3, by our original observation. However, there are only three cases where there are exactly three 2's in a segment of $9$ numbers. In particular, they are
\[ 2, 1, 1, 2, 1, 1 ,2 , 1, 1 \]
\[ 1, 2, 1, 1, 2, 1, 1, 2, 1 \]
\[ 1, 1, 2, 1, 1, 2, 1, 1, 2 .\]
Note that we rule out all strings of 9 numbers with a consecutive run of three 1's or three 2's. 

In each of the above cases, we can look at the block lengths. Since the sequence is self-referential, the consecutive subsequence of block lengths must have appeared earlier in the sequence. The block lengths for the three above sequences are:
\[ 2, 1, 2, 1, 2 \]
\[ 1, 2, 1, 2, 1\]
\[ 2, 1, 2, 1, 2 .\] 
We repeat this reasoning. If the above segments were in the self-referencing sequence, then so is $1, 1, 1$, a contradiction. This means that none of the above consecutive subsequences of length 9 are possible, which implies that in every consecutive subsequence of length $9$, there must be at least four 2's. In other words, in addition to having one 2 for every group of 3, there is another 2 for every group of 9. Therefore, the density must be bounded by
\[ \dfrac{1}{3} + \dfrac{1}{9} \leq d_2 \leq 1 - \dfrac{1}{3} - \dfrac{1}{9} \]
We can try to continue this process for higher powers of $3$. For subsequences of length 27, our result for subsequences of length 9 tells us that we must have at least twelve 2's. But we were able to show that a contradictino is reached in each of these cases, similar to the way a contradiction is reached above. So for consecutive subsequences of length 27, there must be at least thirteen 2's. Thus, the density bounded by
\[ \dfrac{1}{3} + \dfrac{1}{9} + \dfrac{1}{27} \leq d_2 \leq 1 - \dfrac{1}{3} - \dfrac{1}{9} - \dfrac{1}{27} \]
Unfortunately, we have not been able to generalize this reasoning, as the number of cases that must be checked increases exponentially fast. There are $3$ choices for where to put the $2$ in the groups of $3$, $3$ choices for where to put the 3 groups of 2's and 2 positions within these groups for the groups of 9, and so on.

If there exists a pattern that we can make general statements about for arbitrary powers of 3, then this will imply that the density is bounded below and above by
\[ \sum_{n=1}^\infty \dfrac{1}{3^n} = \frac{1}{2} \]
Note that this would also imply the existence of a density. The previous claims can only hope to bound the density, if it exists. The issue is that the ``limiting" density may not exist as it may oscillate between the two bounds. But if the bound is tight (upper and lower bounded at $1/2$) then there is no room for oscillation, and so the density would exist.

\section{Unresolved Problems}
\emph{Written by Fermi Ma, edited by Perry Kleinhenz and Erik Waingarten}

If we had more time to work on this project, we would investigate the following unresolved questions.

\begin{itemize}
\item In Section~\ref{equivalence}, we considered the idea that perhaps the number that we start a sequence with does not matter. In other words, it may be true that any sequence that uses a certain generating cycle is equivalent to any other sequence that uses the same generating cycle. Alternatively, it may be the case that the same generating cycle may yield two sequences that are not equivalent. We would like to know which is actually true.
\item In Section~\ref{substitutionrules}, we look at substitution rules for certain ``nice" generating cycles of numbers, such as $(13)$ and $(24)$. However, we leave unresolved the question of determining precisely which sets allow for substitution rules and which ones ones do not. The major difficulty here seems to come in proving that a certain generating cycle does \emph{not} allow for substitution rules. It seems very hard to come up with a set of substitution rules for $(12)$ and a proof for why this is impossible would be interesting.
\item In Section~\ref{densitybounds} we were able to give certain bounds on the density, if it exists, for the original self-referential sequence of 1's and 2's. Given more time, we would want to see if we could extend our reasoning to the case of length 81 sequences, and perhaps even further. This would, of course, require a more clever way of proving our claims than the way we have used so far.
\end{itemize}

\section{Poetry}
\emph{Written by Fermi Ma and Erik Waingarten}\\

\noindent A sequence referring to its past\\
seems quite simple --- not so fast!\\
Sure, it is deterministic,\\
but tell me the density statistic.\\

\noindent Well, try (one, three) and you will see\\
the density* is point six-oh-three.\\
Just write the substitution rule.\\
To miss the answer, you'd be a fool.\\

\noindent Now do the same for one and two,\\
Look at the rule and now you ---\\
hold on, this doesn't work for numbers of different parity.\\

*if it exists

\end{document}  
